## 1.25 
遇到了assertion error，说明input-ids超过了max-length。
codeT5做分类任务需要输入什么features

## 1.26
跑通codeT5+prompt的测试了，关键在于模型输入的时候需要一个decoder_input_ids的feature
在test文件里比较了t5-small和t5-base，都跑了20个epoch，发现small的效果更好一点，所以就用small来作为模型了。

## 2.8
跑完codeT5+prompt的测试，python mrr: 0.5967964600174649

## 2.10
正在跑codeT5+prompt的java测试。

尝试解决超过max-seq-length的bug。
tokenizer的encode和tokenize函数实现的是不一样的效果。
https://zhuanlan.zhihu.com/p/366911389

## 2.13
计算t5+prompt的java mrr值，出现了错误。
bug1：处理第13个batch时出现如下错误：
  File "mrr.py", line 30, in main
    correct_score = float(batch_data[batch_idx].strip().split('<CODESPLIT>')[-1])
IndexError: list index out of range
尝试把13个batch删了再重跑。
应该是12号有问题，误删了13号。

出现了系统bug，watchdog一直在报告bug。


## 3.4
参考T5中的glue QQP，https://github.com/google-research/text-to-text-transfer-transformer/blob/main/t5/data/preprocessors.py

我可以将输入转化成如下格式
{
       "inputs": (
           "code: Why do I easily get bored of my friends? query: Why do I get bored of my friends so quickly?"
       ),
       "targets": "relevant",
      "idx": 10,
}
代码已经放在t5-utils里面的glue函数里，接下来就是把glue函数改到convert-to-feature里。


## 4.5
目前补了hard-prompt的java、php数据集。
java数据集的测试还没有跑。
pytho数据集的测试还没跑完。(在hard-php窗口里面)
接下来跑go数据集（在train窗口里面）

## 4.7
python数据集的测试跑完。
接下来跑java数据集的测试（在eval窗口里面）
go数据集的训练跑完。
下来跑ruby数据集的训练。（在train窗口里面）

ruby数据集的训练跑完。
接下来跑JavaScript数据集的训练（在train窗口里面）

## 4.8
hard-prompt JavaScript数据集训练跑完。
接下来跑mixed-prompt ruby数据集的训练（在train窗口里面）

go的训练要迁移到/data目录下
python的测试要迁移到/data目录下
test/python/hard-prompt1也要迁移到/data目录下
上述数据迁移都已完成。

midxed-prompt ruby的训练跑完。
接下来跑mixed-prompt JavaScript的训练。


## 4.9
mixed-prompt JavaScript训练跑完。
接下来跑mixed-prompt php的训练

mixed-prompt全部数据集都已经跑完。
接下来跑hard-prompt的ruby、go、JavaScript测试，分别在eval-XX窗口中
同时还有之前java的测试还没跑完。

之前再测t5-java的mrr值时机器老是出bug，现在把它下载到本地测试一下。

跑t5small+mixedpropmt在JavaScript数据集的训练（在train窗口）
跑t5small+mixedpropmt在go数据集的训练（在train-go窗口）

## 4.10
接下来跑t5small+mixedprompt的go的测试（在eval窗口）
跑t5small+mixedprompt的JavaScript的测试（在eval-JavaScript窗口）

接下来跑t5small+mixedprompt的php训练（在train窗口）
跑t5small+mixedprompt的ruby训练（在train-ruby窗口）

## 4.13
已经把t5+mixedprompt的所有训练和测试跑完。
接下来跑bert+mixed的所有测试。其中php在eval窗口里。

## 4.14
看一下这个tensorboard是什么原因。
写一下st的训练代码。

## 4.15
排查了一下tensorboard的原因，把tr-loss=0这句代码删掉就没问题了。
st的训练代码已经写好了。

跑了ruby的训练代码。
接下来跑JavaScript的训练代码和ruby的测试代码。

## 4.22
跑fine-tune php 16个epoch的测试（在eval窗口）
同样，跑go的测试，在eval-go窗口

跑ruby的训练 8个epoch train-ruby窗口（已跑完）

跑JavaScript的训练 8个epoch，train窗口

## 4.23
JavaScript的训练跑完。
接下来跑JavaScript的测试。
跑go的测试，在eval-go窗口。


## 4.25
- [ ] see the mrr value of fine-tune 8epochs 
- [ ] train 16epochs of fine-tune model(ruby, javascript finished)

## 4.30
fine-tune-8:

model:no python

reuslt: no java python

fine-tune:   
model: all 

result: all

把16个epoch的python model移到外面
训练8个epoch的python model


## python+20
epoch   2 loss 0.1190: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 15739/15739 [1:17:46<00:00,  3.37it/s]
--------------------- begin validation -----------------------
This mrr 0.5809385273422801, previous_best_mrr 0.5869894200988289
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_python
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 2 ********************
epoch   3 loss 0.0952: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 15739/15739 [1:17:42<00:00,  3.38it/s]
--------------------- begin validation -----------------------
This mrr 0.5858944275708288, previous_best_mrr 0.5869894200988289
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_python
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 3 ********************
epoch   4 loss 0.0821: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 15739/15739 [1:17:44<00:00,  3.37it/s]
--------------------- begin validation -----------------------
This mrr 0.5793606672636091, previous_best_mrr 0.5869894200988289
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_python
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 4 ********************
epoch   5 loss 0.0746: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 15739/15739 [1:17:40<00:00,  3.38it/s]
--------------------- begin validation -----------------------
This mrr 0.5731812617804963, previous_best_mrr 0.5869894200988289
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_python
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 5 ********************
epoch   6 loss 0.0682: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 15739/15739 [1:17:39<00:00,  3.38it/s]
--------------------- begin validation -----------------------
This mrr 0.5809477453569488, previous_best_mrr 0.5869894200988289
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_python
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
early stop!
Training stop!!!!
model is loaded from ./model/pt100//InputMemory_python
--------------------- begin test -----------------------
############### This stage result is 0.5922814672999425. ###############




## go+pt100
You are using a model of type roberta to instantiate a model of type bert. This is not supported for all configurations of models and can yield errors.
******************** 0 ********************
--------------------- begin validation -----------------------
initial_mrr = 0.0015234716814773723!
epoch   1 loss 0.7630: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 10456/10456 [1:14:44<00:00,  2.33it/s]--------------------- begin validation -----------------------
This mrr 0.852368226132804, previous_best_mrr -1
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 1 ********************
epoch   2 loss 0.0567:  55%|██████████████████████████████████████████████████████████▍                                                | 5713/10456 [39:13<29:43,  2.66it/s]


## ruby+pt100
epoch   2 loss 0.0672: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 20911/20911 [1:01:00<00:00,  5.71it/s]--------------------- begin validation -----------------------
This mrr 0.80481783266585, previous_best_mrr 0.7746331022406258
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 2 ********************
epoch   3 loss 0.0476: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 20911/20911 [1:04:21<00:00,  5.42it/s]--------------------- begin validation -----------------------
This mrr 0.770917760142347, previous_best_mrr 0.80481783266585
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 3 ********************
epoch   4 loss 0.0407: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 20911/20911 [1:21:15<00:00,  4.29it/s]--------------------- begin validation -----------------------
This mrr 0.775687867534352, previous_best_mrr 0.80481783266585
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 4 ********************
epoch   5 loss 1.0888: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 20911/20911 [1:00:58<00:00,  5.72it/s]--------------------- begin validation -----------------------
This mrr 0.0009647538783417328, previous_best_mrr 0.80481783266585
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 5 ********************
epoch   6 loss 2.0807: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 20911/20911 [1:00:58<00:00,  5.72it/s]--------------------- begin validation -----------------------
This mrr 0.0008754449847700323, previous_best_mrr 0.80481783266585
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 6 ********************
epoch   7 loss 2.0801: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████| 20911/20911 [1:00:55<00:00,  5.72it/s]--------------------- begin validation -----------------------
This mrr 0.0006725539660348305, previous_best_mrr 0.80481783266585
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
early stop!
Training stop!!!!
model is loaded from ./model/pt100//InputMemory_go
--------------------- begin test -----------------------
############### This stage result is 0.7710856643944755. ###############


## ruby+pt100
model is saved at ./last_model/pt100//InputMemory_ruby
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 1 ********************
epoch   2 loss 0.2259: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3116/3116 [08:10<00:00,  6.35it/s]
--------------------- begin validation -----------------------
This mrr 0.5504756920834752, previous_best_mrr 0.6622944457625914
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_ruby
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 2 ********************
epoch   3 loss 0.1729: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3116/3116 [08:10<00:00,  6.36it/s]
--------------------- begin validation -----------------------
This mrr 0.6458804922117372, previous_best_mrr 0.6622944457625914
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_ruby
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 3 ********************
epoch   4 loss 0.1430: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3116/3116 [08:09<00:00,  6.36it/s]
--------------------- begin validation -----------------------
This mrr 0.6495105134391569, previous_best_mrr 0.6622944457625914
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_ruby
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 4 ********************
epoch   5 loss 0.1125: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3116/3116 [08:11<00:00,  6.34it/s]
--------------------- begin validation -----------------------
This mrr 0.609826572655051, previous_best_mrr 0.6622944457625914
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_ruby
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 5 ********************
epoch   6 loss 0.0981: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████| 3116/3116 [08:11<00:00,  6.34it/s]
--------------------- begin validation -----------------------
This mrr 0.648780766787276, previous_best_mrr 0.6622944457625914
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_ruby
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
early stop!
Training stop!!!!
model is loaded from ./model/pt100//InputMemory_ruby
--------------------- begin test -----------------------
############### This stage result is 0.6253271589257262. ###############

## go+pt20
epoch   2 loss 0.0650: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 20911/20911 [53:13<00:00,  6.55it/s]--------------------- begin validation -----------------------
This mrr 0.8059361502684708, previous_best_mrr 0.8005742602464593
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 2 ********************
epoch   3 loss 0.0493: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 20911/20911 [53:16<00:00,  6.54it/s]--------------------- begin validation -----------------------
This mrr 0.7769316973687299, previous_best_mrr 0.8059361502684708
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 3 ********************
epoch   4 loss 0.0416: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 20911/20911 [53:16<00:00,  6.54it/s]--------------------- begin validation -----------------------
This mrr 0.7562687405727345, previous_best_mrr 0.8059361502684708
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 4 ********************
epoch   5 loss 1.8094: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 20911/20911 [53:16<00:00,  6.54it/s]--------------------- begin validation -----------------------
This mrr 0.0009879128368058387, previous_best_mrr 0.8059361502684708
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 5 ********************
epoch   6 loss 2.1106: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 20911/20911 [53:24<00:00,  6.52it/s]--------------------- begin validation -----------------------
This mrr 0.0008341947607314088, previous_best_mrr 0.8059361502684708
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
******************** 6 ********************
epoch   7 loss 2.0857: 100%|██████████████████████████████████████████████████████████████████████████████████████████████████████████| 20911/20911 [53:34<00:00,  6.51it/s]--------------------- begin validation -----------------------
This mrr 0.0006115318433224355, previous_best_mrr 0.8059361502684708
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
model is saved at ./last_model/pt100//InputMemory_go
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
early stop!
Training stop!!!!
model is loaded from ./model/pt100//InputMemory_go
--------------------- begin test -----------------------
############### This stage result is 0.7897968833221147. ###############